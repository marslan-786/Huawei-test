<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huawei Bot Auto-Pilot</title>
    <style>
        body { background: #111; color: #eee; font-family: monospace; text-align: center; padding: 20px; }
        h1 { color: #ff3b30; }
        .btn-group { margin: 20px 0; }
        button {
            padding: 15px 25px; font-size: 16px; border: none; cursor: pointer; border-radius: 5px; margin: 5px;
            font-weight: bold;
        }
        .btn-check { background: #007aff; color: white; }
        .btn-video { background: #34c759; color: white; }
        
        #status { color: yellow; margin-bottom: 20px; }
        
        .gallery-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            padding: 10px;
            background: #222;
            border-radius: 10px;
            max-height: 500px;
            overflow-y: auto;
        }
        .gallery-container img {
            width: 100%; border: 1px solid #444; border-radius: 5px;
        }
        
        #video-player {
            margin-top: 20px;
            display: none;
            width: 80%;
            border: 2px solid #34c759;
        }
    </style>
</head>
<body>

    <h1>Huawei Bot: AUTO PILOT</h1>
    <div id="status">Status: System Running Automatically...</div>

    <div class="btn-group">
        <button class="btn-check" onclick="loadGallery()">ðŸ“¸ Check Pictures</button>
        <button class="btn-video" onclick="makeVideo()">ðŸŽ¬ Convert to Video</button>
    </div>

    <video id="video-player" controls>
        <source id="video-source" src="" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <div class="gallery-container" id="gallery">
        </div>

    <script>
        // Auto Load Gallery on page open
        window.onload = loadGallery;

        function loadGallery() {
            document.getElementById('status').innerText = "Fetching latest captures...";
            fetch('/gallery-data')
            .then(res => res.json())
            .then(images => {
                const container = document.getElementById('gallery');
                container.innerHTML = ""; // Clear old
                images.reverse().forEach(src => { // Show newest first
                    const img = document.createElement('img');
                    img.src = src + "?t=" + new Date().getTime(); // Cache bust
                    container.appendChild(img);
                });
                document.getElementById('status').innerText = "Gallery Updated: " + images.length + " Frames";
            });
        }

        function makeVideo() {
            document.getElementById('status').innerText = "Generating Video (Please wait)...";
            fetch('/make-video')
            .then(res => res.json())
            .then(data => {
                if (data.error) {
                    alert("Error: " + data.details);
                } else {
                    document.getElementById('status').innerText = "Video Ready!";
                    const player = document.getElementById('video-player');
                    const source = document.getElementById('video-source');
                    
                    source.src = data.video_url + "?t=" + new Date().getTime();
                    player.style.display = "block";
                    player.load();
                    player.play();
                }
            });
        }
        
        // Auto refresh gallery every 5 seconds
        setInterval(loadGallery, 5000);
    </script>
</body>
</html>
